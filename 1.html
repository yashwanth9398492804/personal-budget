<!DOCTYPE html>
<html lang="en">

  
<head>
    <meta charset="UTF-8">

    <!-- This is an SEO Change (added meta)-->
    <meta name="description" content="A personal-budget management tool that helps to manage your companies budget effectively">
    <meta name="keywords" content="Budgment Management,Personal Budgement Management,financial Management">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Budget</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="main.css">
    <link rel="canonical" href="http://127.0.0.1:5500/pb" />
</head>

<body>

    <!-- This is an A11y Change (used ARIA Roles-(ARIA is a set of standards to make user interface controls more accessible for those using assistive technologies.))-->
    <div class="menu"
        role="Navigation">
        <ul>
            <li><a href="/">Homepage</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="/login.html">Login</a></li>
            <li><a href="https://google.com">Google</a></li>
            <li class="bar">

                <!-- This is an A11y Change (used ARIA Roles)-->
                <div id="percent-loaded"
                role="progressbar"
                aria-valuenow="75"
                aria-valuemin="0"
                aria-valuemax="100">
                <label for="Personal-Budget Management">Your progress:</label>
                <progress id="file" value="32" max="100"> 32% </progress>
            </div></li>
        </ul>
        <!-- This is an SEO Change(added alt tag for a image so if browser fails to load the image it will display the text in alt tag defining the image) -->
        <img src="app-logo.png" width="60px" height="45px" id=logo alt="Logo image" style="margin-left: auto;" />
    </div>

    <!-- This is a Semantic HTML Change (added header semantic)-->
    <header>
    <div class="hero">
        <h1>Personal Budget</h1>
        <h2>A personal-budget management app</h2>
        
        <!-- This is an A11y Change-->
        <h2><p lang="te" > 
        వ్యక్తిగత-బడ్జెట్ నిర్వహణ</h2></p>
        
    </div>
    </header>

    <div class="container center">
        <!-- This is an A11y Change(Gave proper naming for a class)-->
        <div class="Benefits-of-using-our-tool">

            <div class="text-box">

                <!-- This is a Semantic HTML Change (added section semantic )-->
                <section>
                    
                <!-- This is an A11y Change (changed all h1 tags to h2 to maintain only one h1 tag in the page)-->
                <h2>Stay on track</h2>
                <p>
                    Do you know where you are spending your money? If you really stop to track it down,
                    you would get surprised! Proper budget management depends on real data... and this
                    app will help you with that!
                </p>
                </section>
            </div>
    
            <div class="text-box">
                <section>
                <h2>Alerts</h2>
                <p>
                    What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                </p>
                </section>
            </div>
    
            <div class="text-box">
                <section>
                <h2>Results</h2>
                <p>
                    People who stick to a financial plan, budgeting every expense, get out of debt faster!
                    Also, they to live happier lives... since they expend without guilt or fear... 
                    because they know it is all good and accounted for.
                </p>
                </section>
            </div>
    
            <div class="text-box">
                <section>
                <h2>Free</h2>
                <p>
                    This app is free!!! And you are the only one holding your data!
                </p>
                </section>
            </div>
    
            <div class="text-box">
            <section>
                <h2>Stay on track</h2>
                <p>
                    Do you know where you are spending your money? If you really stop to track it down,
                    you would get surprised! Proper budget management depends on real data... and this
                    app will help you with that!
                </p>
            </section>
            </div>
    
            <div class="text-box">
            <section>
                <h2>Alerts</h2>
                <p>
                    What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                </p>
            </section>
            </div>
    
            <div class="text-box">
                <section>
                <h2>Results</h2>
                <p>
                    People who stick to a financial plan, budgeting every expense, get out of debt faster!
                    Also, they to live happier lives... since they expend without guilt or fear... 
                    because they know it is all good and accounted for.
                </p>
            </section>
            </div>
    
            <div class="text-box">
            
                <h2>Free</h2>
                <p>
                    This app is free!!! And you are the only one holding your data
                </p>
            
            </div>
            <div>
                <section>
                    <h1>Chart (801370664)</h1>
                    <p>
                        <canvas id="myChart" width="800" height="400"></canvas>
                    </p>
                </section>
            </div>
            <div>
                <section>
                <h1>D3JS Chart (801370664)</h1>
                <p>
                    <div id="pie-chart"></div>
                </p>
            </section>
        </div>
            
            

        </div>

    </div>

    <!-- This is a Semantic HTML Change (added footer semantic )-->
    <footer class="bottom">
   
        <div class="center">
            <p>Edited by Gurunath Reddy</p>
            <p>Email : gdyvandi@uncc.edu</p>
            <!-- This is an SEO Change(added proper anchor tag)-->
            <p><a href="https://consumer.gov/managing-your-money/making-budget">More Info on Personal Budget Management</a></p>
        </div>
    
    </footer>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"integrity="sha512-aoTNnqZcT8B4AmeCFmiSnDlc4Nj/KPaZyB5G7JnOnUEkdNpCZs1LCankiYi01sLTyWy+m2P+W4XM+BuQ3Q4/Dg=="crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>
    
    <script src="http://d3js.org/d3.v3.min.js"></script>
    
    <script>

    var dataSource = {
        datasets: [
          {
            data: [],
            backgroundColor: [
                '#ffcd56',
                '#ff6384',
                '#36a2eb',
                '#F08080',
                '#DFFF00',
                '#9FE2BF',
                '#CCCCFF'
            ],
          },
        ],
        labels: [],
      };

      var newD3JSData = [];

      var svg = d3.select("#pie-chart").append("svg").append("g");

      svg.append("g")
        .attr("class", "slices");
      svg.append("g")
        .attr("class", "labels");
      svg.append("g")
        .attr("class", "lines");

      var width = 650,
        height = 300,
        radius = Math.min(width, height) / 2;

      var pie = d3.layout
        .pie()
        .sort(null)
        .value(function (d) {
          return d.budget;
        });

      var arc = d3.svg
        .arc()
        .outerRadius(radius * 0.8)
        .innerRadius(radius * 0.4);

      var outerArc = d3.svg
        .arc()
        .innerRadius(radius * 0.9)
        .outerRadius(radius * 0.9);

      svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

      var key = function (d) {
        return d.data.title;
      };

      var titles = []
      var getTitles = ()=>{
        axios.get("/budget").then(function (res) {
            for(var i=0;i<res.data.length;i++){
                titles.push(res.data[i].title)
            }
        })
      }
      getTitles();

      var color = d3.scale
        .ordinal()
        .domain(titles)
        .range([
        '#ffcd56',
        '#ff6384',
        '#36a2eb',
        '#F08080',
        '#DFFF00',
        '#9FE2BF',
        '#CCCCFF'
        ]);

        function createChart() {
        var ctx = document.getElementById("myChart").getContext("2d");
        var myPieChart = new Chart(ctx, {
          type: "pie",
          data: dataSource,
        });
      }



      function createD3JSChart(data) {
        /* ------- PIE SLICES -------*/
        var slice = svg
          .select(".slices")
          .selectAll("path.slice")
          .data(pie(data), key);

        slice
          .enter()
          .insert("path")
          .style("fill", function (d) {
            return color(d.data.title);
          })
          .attr("class", "slice");

        slice
          .transition()
          .duration(1000)
          .attrTween("d", function (d) {
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function (t) {
              return arc(interpolate(t));
            };
          });

        slice.exit().remove();

        /* ------- TEXT LABELS -------*/

        var text = svg.select(".labels").selectAll("text").data(pie(data), key);

        text
          .enter()
          .append("text")
          .attr("dy", ".35em")
          .text(function (d) {
            return d.data.title;
          });

        function midAngle(d) {
          return d.startAngle + (d.endAngle - d.startAngle) / 2;
        }

        text
          .transition()
          .duration(1000)
          .attrTween("transform", function (d) {
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function (t) {
              var d2 = interpolate(t);
              var pos = outerArc.centroid(d2);
              pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
              return "translate(" + pos + ")";
            };
          })
          .styleTween("text-anchor", function (d) {
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function (t) {
              var d2 = interpolate(t);
              return midAngle(d2) < Math.PI ? "start" : "end";
            };
          });

        text.exit().remove();

        /* ------- SLICE TO TEXT POLYLINES -------*/

        var polyline = svg
          .select(".lines")
          .selectAll("polyline")
          .data(pie(data), key);

        polyline.enter().append("polyline");

        polyline
          .transition()
          .duration(1000)
          .attrTween("points", function (d) {
            this._current = this._current || d;
            var interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return function (t) {
              var d2 = interpolate(t);
              var pos = outerArc.centroid(d2);
              pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
              return [arc.centroid(d2), outerArc.centroid(d2), pos];
            };
          });

        polyline.exit().remove();
      }



      function getBudget() {
        axios.get("/budget").then(function (res) {
         console.log(res.data);
          for (var i = 0; i < res.data.length; i++) {
            dataSource.datasets[0].data[i] = res.data[i].budget;
            dataSource.labels[i] = res.data[i].title;
            newD3JSData.push({
              "title": res.data[i].title,
              "budget": res.data[i].budget,
            });
          }
          createChart();
          createD3JSChart(newD3JSData);
        });
      }

      getBudget();
    </script>
</body>
</html>